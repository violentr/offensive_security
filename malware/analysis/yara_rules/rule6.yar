import "hash"
import "pe"

rule sampleB
{
  meta:
    description = "Rule to find samples"
  strings:
    $mz = {4d 5a}
    $str1 = "c:\\users\\x0rc1\\downloads\\dnscat2-master\\dnscat2-master\\client\\controller\\controller.c" nocase ascii wide
    $str2 = "SOFTWARE\\Wow6432Node\\Microsoft\\VisualStudio\\14.0\\Setup\\VC" nocase ascii wide
    $str3 = "COMMAND_EXEC [response]" nocase ascii wide
    $str4 = "f:\\dd\\vctools\\crt\\vcruntime\\src\\eh\\" nocase ascii wide
    $str5 = "http://www.attacker.domain" nocase ascii wide
    $str6 = "c:\\users\\x0rc1\\downloads\\dnscat2-master\\" nocase ascii wide
    $str7 = "./dnscat --dns domain=skullseclabs.org" nocase ascii wide
    $str8 = "minkernel\\crts\\ucrt\\src\\appcrt\\misc\\" nocase ascii wide
  condition:
    ($mz at 0 and 3 of ($str*)) and ( hash.md5(0, filesize) == "cc15158dfae434fee2e5c95ff88b5ba8"
    or hash.sha1(0, filesize) == "fc2c666215fa8c61842664a0ce9b144b1bba7351")
    and pe.imports("advapi32.dll","CryptGenRandom")
    and pe.imports("kernel32.dll", "TerminateProcess")
    and pe.imports("kernel32.dll", "IsDebuggerPresent")
}