import "hash"
import "pe"
import "math"

rule Sample_packed
{
	meta:
	description = "Rule find packed"
	condition:
	(uint16(0) == 0x5A4D) and ( hash.md5(0, filesize) =="e24c5cab297aa835d34a66a59cb1800e" or
	 hash.sha1(0, filesize) == "9ac0b98172f210871b239f1f415d3f322a285448") and
	pe.version_info["CompanyName"] contains "OPTSoft"
	or pe.version_info["Filedescription"] contains "Performas NTFS file system optimization"
  	or pe.version_info["InternalName"] contains "File System Optimizer"

	and pe.number_of_sections == 3
	and pe.imports("kernel32.dll", "LoadLibraryA")
	and pe.imports("kernel32.dll", "ExitProcess")
	and pe.imports("kernel32.dll", "GetProcAddress")
	and pe.imports("kernel32.dll", "VirtualProtect")
	and pe.imports("WSOCK32.dll", "WSAStartup")
	and math.entropy(0, filesize) >=7.0
}